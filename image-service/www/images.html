<!DOCTYPE html>
<html>
<head>
  <title>My Web</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="www/w3.css">
  <link rel="stylesheet" href="bower_components/font-awesome/css/font-awesome.min.css">
  <link rel="stylesheet" href="www/index.css">
</head>
<body ng-app="myApp" ng-cloak ng-controller="myCtrl">
  <!-- Navbar -->
  <div class="w3-top">
    <ul class="w3-navbar w3-padding-8 w3-black">
      <li><a href="#"><i class="fa fa-home w3-large"></i></a></li>
      <li><a href="#">Boards</a></li>
      <li><a href="#">Link 2</a></li>
      <li><a href="#">Link 3</a></li>
      <li class="w3-right">
        <button class="w3-btn w3-margin-right w3-green w3-hover-opacity" onclick="document.getElementById('id03').style.display='block'">
          <i class="fa fa-plus"></i> New Thread
        </button>
      </li>
      <!--<li class="w3-right">
        <div>
          <input class="w3-input w3-animate-input" style="width:30%" type="text" autocomplete="off" spellcheck="false" placeholder="Search posts...">
          <button class="w3-btn w3-blue w3-hover-"><i class="fa fa-search"></i></button>
        </div>
      </li>-->
    </ul>
  </div>
  <div class="w3-container w3-padding-16 w3-light-grey" style="margin-top:54px">
    <div ng-repeat="p in pinned" class="w3-display-container w3-card-8 w3-right w3-hover-opacity w3-animate-zoom">
      <img ng-src="{{p}}" class=" " style="width:100px; cursor:pointer;">
      <span ng-click="unpin($index)" class="w3-display-topright w3-closebtn w3-hover-text-red">×</span>
    </div>
  </div>
  <!-- Modal -->
  <div id="id00" class="w3-modal">
    <div class="w3-modal-content w3-card-8 w3-animate-top" style="max-width:400px">
      <header class="w3-container">
        <span onclick="document.getElementById('id00').style.display='none'" class="w3-closebtn" style="color: #222;">×</span>
        <h2>Report Post</h2>
      </header>
      <div class="w3-container">
        <h5>Would you really like to report this post?</h5>
      </div>
      <footer class="w3-container w3-border-top w3-padding-8">
        <button type="button" class="w3-btn w3-red w3-right">Report</button>
      </footer>
    </div>
  </div>
  <div id="id01" class="w3-modal">
    <div class="w3-modal-content w3-card-8 w3-animate-zoom">
      <header class="w3-container">
        <span onclick="document.getElementById('id01').style.display='none'" class="w3-closebtn">×</span>
        <h2>
          Preview
          <span class="w3-tooltip fa fa-star action pin">
            <span class="w3-text w3-tag">Watch</span>
          </span>
        </h2>
      </header>
      <div class="w3-container">
        <img id="img01" style="width:100%">
      </div>
      <!--<footer class="w3-container">
        <p>Modal Footer</p>
      </footer>-->
    </div>
  </div>
  <div id="id02" class="w3-modal">
    <div class="w3-modal-content w3-card-8 w3-animate-top">
      <header class="w3-container">
        <span onclick="document.getElementById('id02').style.display='none'" class="w3-closebtn">×</span>
        <h4>Popular Posts</h4>
      </header>
      <div class="w3-container">
        <ul class="w3-ul w3-white">
          <li ng-repeat="p in pinned" class="w3-padding-16 w3-hover-light-grey">
            <span class="w3-closebtn w3-padding w3-margin-right w3-large w3-hover-text-red">×</span>
            <img ng-src="{{p}}" alt="Image" class="w3-left w3-margin-right" style="width:50px">
            <span class="w3-large">Lorem</span><br>
            <span>Sed mattis nunc</span>
          </li>
        </ul>
      </div>
      <footer class="w3-container w3-border-top w3-padding-8">
        <button onclick="document.getElementById('id02').style.display='none'" type="button" class="w3-btn w3-red w3-right">Cancel</button>
      </footer>
    </div>
  </div>
  <div id="id03" class="w3-modal">
    <div class="w3-modal-content w3-card-8 w3-animate-top" style="max-width:600px">
      <header class="w3-container w3-border-bottom">
        <span onclick="document.getElementById('id03').style.display='none'" class="w3-closebtn">×</span>
        <h4>New Thread</h4>
      </header>
      <div class="w3-container">
        <div class="w3-section">
          <label><b>Title</b></label>
          <input class="w3-input w3-border w3-margin-bottom" type="text" placeholder="I love cats">
          <label><b>Content</b> (optional)</label>
          <textarea class="w3-input w3-border w3-margin-bottom" type="text" placeholder="Because meow"></textarea>
          <label><b>Image</b></label>
          <input class="w3-input w3-border w3-margin-bottom" type="file">
          <label><b>Board</b></label>
          <select class="w3-select w3-border" name="option">
            <option value="" disabled selected>Choose your option</option>
            <option value="1">Option 1</option>
            <option value="2">Option 2</option>
            <option value="3">Option 3</option>
          </select>
        </div>
      </div>
      <footer class="w3-container w3-border-top w3-padding-8">
        <i>Please read the <a href="">Rules</a> and <a href="">FAQ</a> before posting.</i>
        <button class="w3-btn w3-right w3-green">Post</button>
      </footer>
    </div>
  </div>
  <!-- Page Container -->
  <div class="w3-container w3-animate-left">
    <h2>Popular Threads</h2>
    <div ng-repeat="r in images.length / 6 | range" class="w3-row-padding w3-margin-top">
      <div ng-repeat="c in 6 | range" ng-if="r * 6 + c < images.length" class="w3-col s2 m2 l2">
        <div class="w3-card-2">
          <div class="w3-display-container parent">
            <img ng-src="{{images[r * 6 + c]}}" onclick="onClick(this)" style="width:100%; cursor:pointer;">
            <span class="w3-display-topright w3-margin-2 w3-padding-2 w3-black w3-round"><i>GIF</i></span>
            <span class="w3-display-topleft w3-black w3-opacity actions" style="width:100%;">
              <span class="w3-right w3-margin-4 w3-large fa fa-thumb-tack action pin" ng-click="pin(r * 6 + c)"></span>
              <span class="w3-margin-4 w3-large fa fa-flag action report" onclick="document.getElementById('id00').style.display='block'"></span>
            </span>
          </div>
          <!--<div class="w3-container w3-padding-8">
            <span class="w3-right fa fa-heart like" style="margin-left :8px;">
              <span style="font-size: 12px;line-height: 1;">2145</span>
            </span>
            <span class="w3-right fa fa-comment like" style="margin-left: 8px;">
              <span style="font-size: 12px;line-height: 1;">125</span>
            </span>
            <span class="w3-right fa fa-eye like" style="margin-left: 8px;">
              <span style="font-size: 12px;line-height: 1;">10k</span>
            </span>
          </div>-->
          <!--<ul style="list-style: none;">
            <li ng-repeat="c in colors" style="float: left; width: 12.5%;">
              <a style="background-color: {{c}}; height: 12px; width: 100%;" title="" href="">fsdfsdf</a>
            </li>
          </ul>-->
        </div>
      </div>
    </div>
  </div>

  <script src="bower_components/angular/angular.min.js"></script>
  <script>
  function onClick(element) {
    var isGif = element.src.substr(element.src.length - 3) == 'gif';
    console.log(element.src.substr(element.src.length - 3));
    if (isGif) {
      element.src = element.src.replace('thumbnail', 'original').replace('.jpg', '.gif');
    } else {
      document.getElementById("img01").src = element.src.replace('thumbnail', 'original');
      document.getElementById("id01").style.display = "block";
    }
  }
  var app = angular.module("myApp", []);
  app.filter('range', function() {
    return function(n) {
      var res = [];
      for (var i = 0; i < n; i++) {
        res.push(i);
      }
      return res;
    };
  });
  app.filter('shorten', function () {
    return function (value, wordwise, max, tail) {
      if (!value) return '';

      max = parseInt(max, 10);
      if (!max) return value;
      if (value.length <= max) return value;

      value = value.substr(0, max);
      if (wordwise) {
        var lastspace = value.lastIndexOf(' ');
        if (lastspace != -1) {
          value = value.substr(0, lastspace);
        }
      }

      return value + (tail || ' …');
    };
  });
  app.filter('elapsed', function(){
    return function(date) {
      if (!date) return;
      var time = date,
      now = new Date().getTime(),
      diff = now - time,
      seconds = Math.floor(diff / 1000),
      minutes = Math.floor(seconds / 60),
      hours = Math.floor(minutes / 60),
      days = Math.floor(hours / 24);
      if (days > 1) return days + " jours";
      else if (days == 1) return "1 jour";
      else if (hours > 1) return hours + " heures";
      else if (hours == 1) return "une heure";
      else if (minutes > 1) return minutes + " minutes";
      else if (minutes == 1) return "une minute";
      return "quelques secondes";
    }
  });
  app.controller("myCtrl", function($scope, $http, LocalService) {

    $scope.colors = [
      '#404948', '#948c86', '#616650', '#c5bebd',
      '#4f564c', '#78775e', '#dad4d2', '#ada6a6'
    ];

    $scope.images = [];
    $scope.pinned = [];
    var pins = LocalService.getObject('pinned');
    if (pins) $scope.pinned = pins;

    $http.get('/photos').then(function(response) {
      $scope.images = response.data
    });

    $scope.pin = function(index) {
      for (var i = 0; i < $scope.pinned.length; i++) {
        if ($scope.images[index] === $scope.pinned[i]) {
          return;
        }
      }
      $scope.pinned.push($scope.images[index]);
      LocalService.setObject('pinned', $scope.pinned);
    }

    $scope.unpin = function(index) {
      $scope.pinned.splice(index, 1);
      LocalService.setObject('pinned', $scope.pinned);
    }
  });
  </script>
  <script src="localService.js"></script>
</body>
</html>
